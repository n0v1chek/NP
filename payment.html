<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã */
        .payment-type-toggle {
            display: flex;
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
        }

        .payment-type-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            background: transparent;
            color: var(--tg-theme-hint-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .payment-type-btn.active {
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* –°–µ–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ */
        .company-section {
            display: none;
            margin-bottom: 24px;
        }

        .company-section.visible {
            display: block;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--tg-theme-text-color);
        }

        .employee-list {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .employee-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .employee-item:last-child {
            border-bottom: none;
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .employee-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .employee-name {
            font-size: 14px;
            font-weight: 500;
        }

        .employee-gens {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gens-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gens-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .gens-count {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            font-size: 15px;
        }

        .distribution-total {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .distribution-total .label {
            color: var(--tg-theme-hint-color);
        }

        .distribution-total .value {
            font-weight: 600;
        }

        /* –°–µ–∫—Ü–∏—è –ª–∏—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã */
        .personal-section {
            display: block;
        }

        .personal-section.hidden {
            display: none;
        }

        .amount-display {
            text-align: center;
            margin-bottom: 32px;
        }

        .amount-value {
            font-size: 52px;
            font-weight: 700;
            color: var(--tg-theme-button-color);
            line-height: 1;
        }

        .amount-currency {
            font-size: 24px;
            color: var(--tg-theme-hint-color);
            margin-left: 5px;
        }

        .generations-info {
            font-size: 16px;
            color: var(--tg-theme-hint-color);
            margin-top: 12px;
        }

        .generations-count {
            color: var(--tg-theme-text-color);
            font-weight: 600;
        }

        .slider-container {
            padding: 0 10px;
            margin-bottom: 32px;
        }

        .slider-track {
            position: relative;
            height: 60px;
            display: flex;
            align-items: center;
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right,
                var(--tg-theme-button-color) 0%,
                var(--tg-theme-button-color) var(--progress),
                var(--tg-theme-secondary-bg-color) var(--progress),
                var(--tg-theme-secondary-bg-color) 100%);
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--tg-theme-button-color);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s ease;
        }

        .slider::-webkit-slider-thumb:active {
            transform: scale(1.15);
        }

        .slider::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--tg-theme-button-color);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 4px;
        }

        .slider-labels span {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }

        .quick-btn {
            padding: 14px 8px;
            border: 2px solid var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .quick-btn:active {
            transform: scale(0.95);
        }

        .quick-btn.active {
            border-color: var(--tg-theme-button-color);
            background: rgba(36, 129, 204, 0.1);
        }

        .quick-btn .amount {
            font-weight: 700;
            font-size: 17px;
        }

        .quick-btn .gens {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-top: 4px;
        }

        .bonus-badge {
            display: inline-block;
            background: #34c759;
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
        }

        .pricing-info {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .pricing-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .pricing-row:not(:last-child) {
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .pricing-label {
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        .pricing-value {
            font-weight: 600;
            font-size: 14px;
        }

        /* –î–∏—Å–∫–ª–µ–π–º–µ—Ä */
        .disclaimer {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .disclaimer-title {
            font-size: 13px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .disclaimer-text {
            font-size: 12px;
            color: #856404;
            line-height: 1.5;
        }

        @media (prefers-color-scheme: dark) {
            .disclaimer {
                background: linear-gradient(135deg, #3d3200 0%, #4a3d00 100%);
                border-left-color: #ffc107;
            }
            .disclaimer-title,
            .disclaimer-text {
                color: #ffd966;
            }
        }

        .pay-button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: auto;
        }

        .pay-button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .pay-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .payment-method {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            color: var(--tg-theme-hint-color);
            font-size: 13px;
        }

        .payment-method img {
            height: 20px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --tg-theme-bg-color: #1c1c1e;
                --tg-theme-text-color: #ffffff;
                --tg-theme-hint-color: #8e8e93;
                --tg-theme-secondary-bg-color: #2c2c2e;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</p>
    </div>

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã -->
    <div class="payment-type-toggle" id="paymentTypeToggle" style="display: none;">
        <button class="payment-type-btn active" data-type="personal">–î–ª—è —Å–µ–±—è</button>
        <button class="payment-type-btn" data-type="company">–î–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</button>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ -->
    <div class="company-section" id="companySection">
        <div class="section-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:</div>
        <div class="employee-list" id="employeeList">
            <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div class="distribution-total">
            <span class="label">–í—Å–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π:</span>
            <span class="value" id="totalDistribution">0</span>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ª–∏—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã -->
    <div class="personal-section" id="personalSection">
        <div class="amount-display">
            <span class="amount-value" id="amountValue">750</span>
            <span class="amount-currency">&#8381;</span>
            <div class="generations-info">
                = <span class="generations-count" id="gensCount">10</span> –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
            </div>
        </div>

        <div class="slider-container">
            <div class="slider-track">
                <input type="range" class="slider" id="amountSlider"
                       min="1" max="40" value="10" step="1">
            </div>
            <div class="slider-labels">
                <span>75 &#8381;</span>
                <span>3 000 &#8381;</span>
            </div>
        </div>

        <div class="quick-amounts">
            <button class="quick-btn" data-gens="5">
                <div class="amount">375 &#8381;</div>
                <div class="gens">5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</div>
            </button>
            <button class="quick-btn active" data-gens="10">
                <div class="amount">750 &#8381;</div>
                <div class="gens">10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</div>
            </button>
            <button class="quick-btn" data-gens="20">
                <div class="amount">1 500 &#8381;</div>
                <div class="gens">20 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</div>
            </button>
            <button class="quick-btn" data-gens="30">
                <div class="amount">2 250 &#8381;</div>
                <div class="gens">30 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</div>
            </button>
            <button class="quick-btn" data-gens="40">
                <div class="amount">3 000 &#8381;</div>
                <div class="gens">40 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π<span class="bonus-badge">–í—ã–≥–æ–¥–Ω–æ</span></div>
            </button>
            <button class="quick-btn" data-gens="1">
                <div class="amount">75 &#8381;</div>
                <div class="gens">1 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</div>
            </button>
        </div>
    </div>

    <div class="pricing-info">
        <div class="pricing-row">
            <span class="pricing-label">–°—Ç–æ–∏–º–æ—Å—Ç—å 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</span>
            <span class="pricing-value">75 &#8381;</span>
        </div>
        <div class="pricing-row">
            <span class="pricing-label">–í—ã –ø–æ–ª—É—á–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</span>
            <span class="pricing-value" id="totalGens">10</span>
        </div>
        <div class="pricing-row">
            <span class="pricing-label">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>
            <span class="pricing-value" id="totalAmount">750 &#8381;</span>
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ -->
    <div class="disclaimer" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left-color: #2196f3;">
        <div class="disclaimer-title" style="color: #1565c0;">
            <span>üí°</span> –ë—ã—Å—Ç—Ä–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
        </div>
        <div class="disclaimer-text" style="color: #1565c0;">
            –ù–µ–π—Ä–æ—Å–µ—Ç—å —Å–æ–∑–¥–∞—ë—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ —Å–µ–∫—É–Ω–¥—ã ‚Äî –ø–æ–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É –±—É–¥—É—â–∏–π –ø–æ—Ç–æ–ª–æ–∫ –ø—Ä—è–º–æ –Ω–∞ –≤—Å—Ç—Ä–µ—á–µ.
            –õ—é–±–æ–π –ò–ò –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4 —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∞ –≤–º–µ—Å—Ç–æ 2) ‚Äî —Ç–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –≤ –º–∏—Ä–µ. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª—É—á—à–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã.
        </div>
    </div>

    <button class="pay-button" id="payButton">
        –û–ø–ª–∞—Ç–∏—Ç—å 750 &#8381;
    </button>

    <div class="payment-method">
        <span>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑</span>
        <svg height="20" viewBox="0 0 107 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.211-1.447 1.394c-.16.16-.295.295-.605.295l.213-3.053 5.56-5.023c.242-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.643-.203-.658-.643.136-.953l11.566-4.458c.537-.194 1.006.131.833.94z" fill="currentColor"/>
            <text x="28" y="17" font-family="Arial" font-size="14" fill="currentColor">YooKassa</text>
        </svg>
    </div>

    <script>
        const PRICE_PER_GEN = 75;
        const MIN_GENS = 1;
        const MAX_GENS = 40;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const slider = document.getElementById('amountSlider');
        const amountValue = document.getElementById('amountValue');
        const gensCount = document.getElementById('gensCount');
        const totalGens = document.getElementById('totalGens');
        const totalAmount = document.getElementById('totalAmount');
        const payButton = document.getElementById('payButton');
        const quickBtns = document.querySelectorAll('.quick-btn');
        const paymentTypeToggle = document.getElementById('paymentTypeToggle');
        const paymentTypeBtns = document.querySelectorAll('.payment-type-btn');
        const companySection = document.getElementById('companySection');
        const personalSection = document.getElementById('personalSection');
        const employeeList = document.getElementById('employeeList');
        const totalDistribution = document.getElementById('totalDistribution');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let paymentType = 'personal';
        let employees = [];
        let employeeGens = {};
        let isCompanyAdmin = false;

        // Initialize Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();

            // Apply Telegram theme
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#999999');
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#2481cc');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color || '#f0f0f0');

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ initData
            try {
                const initData = tg.initDataUnsafe;
                if (initData && initData.start_param) {
                    const params = JSON.parse(atob(initData.start_param));
                    if (params.employees && params.employees.length > 0) {
                        employees = params.employees;
                        isCompanyAdmin = true;
                        initCompanyMode();
                    }
                }
            } catch (e) {
                console.log('No company data');
            }
        }

        function initCompanyMode() {
            paymentTypeToggle.style.display = 'flex';

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            employees.forEach(emp => {
                employeeGens[emp.id] = 0;
            });

            renderEmployeeList();
        }

        function renderEmployeeList() {
            employeeList.innerHTML = employees.map(emp => {
                const initials = emp.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                return `
                    <div class="employee-item">
                        <div class="employee-info">
                            <div class="employee-avatar">${initials}</div>
                            <div class="employee-name">${emp.name}</div>
                        </div>
                        <div class="employee-gens">
                            <button class="gens-btn" onclick="changeEmployeeGens('${emp.id}', -1)" ${employeeGens[emp.id] <= 0 ? 'disabled' : ''}>-</button>
                            <span class="gens-count">${employeeGens[emp.id]}</span>
                            <button class="gens-btn" onclick="changeEmployeeGens('${emp.id}', 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');

            updateCompanyTotal();
        }

        function changeEmployeeGens(empId, delta) {
            employeeGens[empId] = Math.max(0, (employeeGens[empId] || 0) + delta);

            // Haptic feedback
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.selectionChanged();
            }

            renderEmployeeList();
        }

        function updateCompanyTotal() {
            const total = Object.values(employeeGens).reduce((sum, g) => sum + g, 0);
            totalDistribution.textContent = total;
            totalGens.textContent = total;

            const amount = total * PRICE_PER_GEN;
            totalAmount.textContent = formatNumber(amount) + ' \u20BD';
            payButton.textContent = total > 0 ? `–û–ø–ª–∞—Ç–∏—Ç—å ${formatNumber(amount)} \u20BD` : '–í—ã–±–µ—Ä–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏';
            payButton.disabled = total <= 0;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã
        paymentTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                paymentTypeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                paymentType = btn.dataset.type;

                if (paymentType === 'company') {
                    companySection.classList.add('visible');
                    personalSection.classList.add('hidden');
                    updateCompanyTotal();
                } else {
                    companySection.classList.remove('visible');
                    personalSection.classList.remove('hidden');
                    updateDisplay(parseInt(slider.value));
                }

                // Haptic feedback
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            });
        });

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }

        function updateDisplay(gens) {
            const amount = gens * PRICE_PER_GEN;

            amountValue.textContent = formatNumber(amount);
            gensCount.textContent = gens;
            totalGens.textContent = gens;
            totalAmount.textContent = formatNumber(amount) + ' \u20BD';
            payButton.textContent = `–û–ø–ª–∞—Ç–∏—Ç—å ${formatNumber(amount)} \u20BD`;
            payButton.disabled = false;

            // Update slider progress
            const progress = ((gens - MIN_GENS) / (MAX_GENS - MIN_GENS)) * 100;
            slider.style.setProperty('--progress', progress + '%');

            // Update quick buttons
            quickBtns.forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.gens) === gens);
            });
        }

        slider.addEventListener('input', (e) => {
            const gens = parseInt(e.target.value);
            updateDisplay(gens);

            // Haptic feedback
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.selectionChanged();
            }
        });

        quickBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const gens = parseInt(btn.dataset.gens);
                slider.value = gens;
                updateDisplay(gens);

                // Haptic feedback
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            });
        });

        payButton.addEventListener('click', () => {
            // Haptic feedback
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }

            let paymentData;

            if (paymentType === 'company') {
                const distribution = {};
                let totalGensCount = 0;

                employees.forEach(emp => {
                    if (employeeGens[emp.id] > 0) {
                        distribution[emp.id] = employeeGens[emp.id];
                        totalGensCount += employeeGens[emp.id];
                    }
                });

                paymentData = {
                    action: 'payment',
                    type: 'company',
                    amount: totalGensCount * PRICE_PER_GEN,
                    generations: totalGensCount,
                    distribution: distribution
                };
            } else {
                const gens = parseInt(slider.value);
                paymentData = {
                    action: 'payment',
                    type: 'personal',
                    amount: gens * PRICE_PER_GEN,
                    generations: gens
                };
            }

            // Send data to bot
            if (tg) {
                tg.sendData(JSON.stringify(paymentData));
            } else {
                // For testing outside Telegram
                console.log('Payment data:', paymentData);
                alert(`–¢–∏–ø: ${paymentData.type}\n–°—É–º–º–∞: ${paymentData.amount} \u20BD\n–ì–µ–Ω–µ—Ä–∞—Ü–∏–π: ${paymentData.generations}`);
            }
        });

        // Initial update
        updateDisplay(10);
    </script>
</body>
</html>
